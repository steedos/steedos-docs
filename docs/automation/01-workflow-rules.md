# 工作流规则

:::info 学习目标
* 理解自动化的核心逻辑：**IF (条件) + THEN (动作)**。
* 学会创建一个规则：当合同金额大于 100 万时，自动标记为“重点客户”。
* 掌握三种核心动作：**字段更新**、**邮件提醒**、**WebHook (发送给钉钉/企业微信)**。
* 理解“立即执行”与“时间触发（3天后执行）”的区别。
:::

## 什么是工作流规则？

在没有系统之前，业务通过“人盯人”来运转：
> 销售员张三签了一个大单，他需要手动发微信告诉经理，然后手动去修改客户表里的状态，最后还要记得 3 天后去催款。

如果张三忘了怎么办？

**工作流规则**就是系统的**“24小时值班机器人”**。你只要告诉它规则，它就会盯着每一条数据，一旦符合条件，立即自动干活。

它的逻辑非常简单，就像知名的 IFTTT：
* **IF (触发条件)**：当“合同金额”大于 100 万时。
* **THEN (执行动作)**：自动发送邮件给总经理，并将客户等级改为“VIP”。



---

## 核心三要素

在配置任何规则之前，你只需要想清楚三个问题：

1.  **对象 (Object)**：这事发生在谁身上？（是合同？还是请假单？）
2.  **规则标准 (Criteria)**：什么情况下才触发？（金额 > 100万？还是状态 = 审核驳回？）
3.  **动作 (Action)**：触发后干什么？（发邮件？改字段？还是发钉钉通知？）

---

## 实战演练：大额合同自动标记

**场景**：我们需要一个自动化规则。当任何销售员创建一个金额超过 **1,000,000 元** 的合同时，系统自动将该合同的“重要级别”字段修改为 **“高”**。

### 第 1 步：新建规则
1.  进入 **设置** -> **自动化** -> **工作流规则**。
2.  点击 **新建**。
3.  **对象**选择：`合同 (Contract)`。

### 第 2 步：配置触发时机 (Evaluation Criteria)
这是新手最容易晕的地方，请仔细选择：

* **仅在创建时 (Created)**：
    * 只有新建那一下会触发。以后再修改金额，不会触发。
* **创建，以及每次编辑时 (Created, and every time it's edited)**：
    * **最常用**。不管是新建，还是后来把 50 万改成 100 万，都会触发。
* **创建，以及每次编辑后满足条件时 (Created, and any time it's edited to subsequently meet criteria)**：
    * 比较绕。简单说就是“从不满足变成满足”的那一刻才触发。通常用于“发送通知”场景（避免改一次名字就发一次重复邮件）。

**本例选择：`创建，以及每次编辑时`。**

### 第 3 步：设置规则条件 (Rule Criteria)
告诉机器人，什么样的合同才算“大单”。

* **字段**：`合同: 金额`
* **运算符**：`大于`
* **值**：`1000000`

### 第 4 步：添加动作 (Add Action)
条件满足了，接下来做什么？

1.  在“立即工作流操作”区域，点击 **添加工作流操作** -> **新建字段更新 (Field Update)**。
2.  **名称**：`更新为高优先级`。
3.  **要更新的字段**：选择 `重要级别`。
4.  **新值**：选择 `高`。
5.  点击 **保存**。

🎉 **完成！** 现在你可以去尝试新建一个 200 万的合同，保存后你会发现，“重要级别”已经被系统自动改为“高”了。

---

## 这个机器人还能做什么？ (动作类型)

除了“自动修改字段”，工作流还能做更多事：

### 1. 邮件提醒 (Email Alert)
* **场景**：合同到期前 30 天，给客户发邮件提醒续费。
* **配置**：需要先配置好“邮件模版”，然后在这里选择收件人（可以是固定的经理，也可以是动态的“合同所有者”）。

### 2. 发送 WebHook (Outbound Message)
* **场景**：有新订单时，推送到公司的 **钉钉群** 或 **企业微信群** 机器人。
* **配置**：填写外部系统的 URL 地址。Steedos 会把这条数据的详情打包发过去。

### 3. 时间触发的操作 (Time-Dependent Actions)
这是 CRM 最性感的特性之一——**“让子弹飞一会儿”**。

* **场景**：**“合同到期前 7 天”** 提醒我。
* **如何配置**：
    在工作流规则页面，你会看到一个 **“时间触发器”** 区域。
    1.  添加时间触发器：选择 `合同结束日期` -> `之前` -> `7 天`。
    2.  在这个触发器下添加动作：发送邮件提醒。
    * *系统会自动在这个时间点检查，如果到时候合同还没续签，它就会发出提醒。*

---

## 常见问题 (FAQ)

**Q: 我创建了规则，为什么以前的老数据没有变化？**
A: 工作流规则是**事件驱动**的。它只会在数据 **“被创建”** 或 **“被保存”** 的那一瞬间运行。
* 如果你想让老数据也生效，需要手动把那些老数据批量编辑保存一下（哪怕不改内容，点一下保存也能触发）。

**Q: 规则会有冲突吗？（死循环）**
A: 会。
* 例如：规则 A 说“金额 > 100 万，设为 VIP”；规则 B 说“VIP 客户，金额设为 50 万”。
* 这就乱套了。在设计规则时，请务必保持逻辑清晰，避免互相打架。

**Q: 多个规则的执行顺序是什么？**
A: 系统不保证特定的顺序。所以尽量不要让两个规则去修改同一个字段。

**Q: 怎么暂时停用一个规则？**
A: 在规则列表中，点击该规则旁的 **“激活 (Active)”** 勾选框，取消勾选即可。不需要删除规则。