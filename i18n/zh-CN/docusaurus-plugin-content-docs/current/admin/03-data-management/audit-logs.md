
# 审计日志与历史追踪

为了满足企业的数据合规性要求（如审计追踪、责权认定），Steedos 提供了完善的“后悔药”机制。管理员可以追踪“谁、在什么时间、修改了什么数据”，以及数据修改前后的具体值。

Steedos 的审计体系主要分为两部分：

1.  **字段历史追踪 (Field History Tracking)**：记录业务数据的变更（如：合同金额从 10万 变为 20万）。
2.  **系统操作日志 (System Audit Logs)**：记录登录与敏感操作（如：谁导出了数据、谁修改了权限）。

## 1\. 字段历史追踪

这是最常用的审计功能，用于追踪某个具体业务记录的生命周期变化。

### 1.1 启用追踪

默认情况下，对象不仅不会追踪历史，开启后也不会追踪所有字段（以节省存储空间）。管理员需要显式配置。

1.  **进入对象设置**：
      * 进入 **“设置”** \> **“对象设置”**。
      * 点击需要追踪的对象（例如“合同 Contract”）。
2.  **开启历史记录**：
      * 在对象的基本属性中，勾选 **“启用历史记录 (Track History)”**。
3.  **选择追踪字段**：
      * 进入该对象的 **“字段”** 设置页。
      * 点击右上角的 **“设置历史追踪 (Set History Tracking)”** 按钮。
      * 在弹出的列表中，勾选那些敏感且重要的字段。
          * *建议追踪*：金额、状态、所有者、截止日期。
          * *不建议追踪*：长文本描述、公式字段（通常不可追踪）、频繁变动的非关键字段。

### 1.2 查看历史记录

配置生效后，系统会自动在后台记录变更。要让最终用户看到这些记录，需要将历史列表添加到页面布局中。

1.  **调整页面布局**：
      * 在对象设置中，点击 **“页面布局 (Page Layouts)”**。
      * 在 **“相关列表 (Related Lists)”** 区域，将 **“合同历史 (Contract History)”** 拖拽到页面下方。
2.  **前台效果**：
      * 打开任意一条合同记录，在详情页底部的“历史”相关列表中，您可以看到如下信息：
          * **日期**：2023-10-01 10:00
          * **用户**：张三
          * **操作**：将 **金额** 从 `10,000` 修改为 `20,000`。

:::warning 注意
历史追踪功能记录的数据通常是只读的，管理员也无法修改历史审计记录，以确保审计的公正性。
:::

## 2\. 登录审计日志

管理员需要监控系统的访问安全性，了解是否有异常登录行为。

### 查看登录历史

1.  进入 **“设置”** \> **“组织”** \> **“用户”**。
2.  点击某个具体用户（如 Admin）。
3.  在用户详情页的 **“登录历史 (Login History)”** 相关列表中，可以看到：
      * **登录时间**
      * **源 IP 地址**
      * **登录状态**（成功、密码错误、受限IP等）
      * **浏览器/设备信息**

> **场景应用**：如果发现某个账号在深夜通过陌生的异地 IP 频繁尝试登录且失败，管理员应立即冻结该账号并重置密码。

## 3\. 最佳实践

### 3.1 追踪策略

不要追踪所有字段。

  * **性能考量**：虽然 Steedos 能够处理大量数据，但无意义的追踪（如追踪一个“备注”字段里的标点符号修改）会迅速消耗数据库存储空间，并干扰查阅关键信息。
  * **合规考量**：重点追踪涉及 **“钱、权、状态”** 的字段。

### 3.2 数据保留

审计日志也是数据的一种。随着系统运行年份增加，审计表会变得非常巨大。

  * 建议定期（如每年）通过 **数据导出** 功能将两年前的历史审计记录导出冷备份，然后从生产数据库中清除，以保持系统轻量。

### 3.3 审计不是万能的

字段历史追踪只能记录“修改了什么”。如果需要知道“谁查看了这条数据（但未修改）”，这属于更高级的 **“访问日志 (Access Logs)”** 范畴，通常需要通过系统底层日志或定制开发来实现，会产生海量日志数据，请根据实际安全级别需求开启。
